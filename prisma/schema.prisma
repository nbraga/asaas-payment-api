// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client-js"
    output   = "../generated/prisma"
}

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

model User {
    id        String         @id @default(cuid())
    email     String         @unique
    password  String
    fullName  String
    phone     String
    status    UserStatusType @default(PENDING)
    createdAt DateTime       @default(now())
    updatedAt DateTime       @updatedAt
    deletedAt DateTime?
}

model Package {
    id           String      @id @default(uuid())
    name         String
    type         PackageType
    processLimit Int?
    price        BigInt
    order        Int
    isMain       Boolean     @default(false)
    isActive     Boolean     @default(true)
    createdAt    DateTime    @default(now())
    deletedAt    DateTime?

    subscriptions Subscription[]

    @@map("packages")
}

model Subscription {
    id                        String                 @id @default(uuid())
    billingType               BillingType
    cycle                     CycleType              @default(MONTHLY)
    status                    SubscriptionStatusType @default(ACTIVE)
    externalRefSubscriptionId String?
    nextDueDate               DateTime?
    endDate                   DateTime?
    last4CardDigits           String?

    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    package   Package @relation(fields: [packageId], references: [id], onDelete: Cascade)
    packageId String

    Payments Payment[]

    @@map("subscriptions")
}

model Payment {
    id                   String            @id @default(uuid())
    price                BigInt
    billingType          BillingType
    status               PaymentStatusType @default(PENDING)
    externalRefPaymentId String
    last4CardDigits      String?
    invoiceUrl           String?
    paidAt               DateTime?
    paymentGateway       String?           @default("ASAAS")

    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime?

    subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
    subscriptionId String

    @@map("payments")
}

enum RoleType {
    SUPER_ADMIN
    ADMIN
    BUYER
    SELLER
}

enum UserStatusType {
    PENDING
    DISABLED
    ACTIVE
}

enum SubscriptionStatusType {
    ACTIVE
    DISABLED
    CANCELLED
    PENDING
}

enum BillingType {
    CREDIT_CARD
    BOLETO
    PIX
}

enum PaymentStatusType {
    PAID
    PENDING
    REFUNDED
}

enum CycleType {
    MONTHLY
    SEMIANNUALLY
    YEARLY
}

enum PackageType {
    BRONZE
    SILVER
    GOLD
}
